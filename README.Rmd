---
author:
  - name: Matthieu Stigler
    affiliation: UC Davis
    email: matthieu.stigler@gmail.com
    address: California
    url: https://matthieustigler.github.io/
  - name: Bastiaan Quast
    affiliation: The Graduate Institute, Geneva
    address: >
      Maison de la paix
      Geneva, Switzerland
    email: bquast@gmail.com
    url: http://qua.st/
title:
  formatted: "\\pkg{rddtools}: tools for Regression Discontinuity Design in R"
  plain:     "rddtools: tools for Regression Discontinuity Design in R"
  short:     "\\pkg{rddtools}"
abstract: >
  The rddtools package implements functions for handling Regression Discontinuity Design in R.
keywords:
  formatted: [RDD, Regression, Discontinuity, Design, "\\proglang{R}"]
  plain:     [RDD, Regression, Discontinuity, Design R]
submitdate: 2015-07-25  
preamble: >
  \usepackage{amsmath}
output:
  md_document
   
  rticles::jss_article 
bibliography: bibliography.bib
---

# Introduction

The `rddtools` package attempts to provide a unified approach to using Regression Discontinuity Design (RDD) in R.


# Design

A unified framework for RDD is implemented through the `rdd_data` class which inherits from the `R` `base` package's `data.frame` class.
This functionality is made accessible through the associated `rdd_data` function,
as well as the following associated methods.

- `summary.rdd_data()`
- `plot.rdd_data()`

The package is designed to leveredge of existing implementations of **Regression Discontinuity Design** in `R`, such as the `rdd` and `KernSmooth` packages.
In addition to this, it implements several tools for RDD analysis that were previously unavailable.

- Simple visualisation of the data using binned-plot: `plot()`

## Bandwidth Selection

Two new mehtods for Bandwidth selection are included.
    - MSE-RDD bandwidth procedure of [@imbens2012optimal]: `rdd_bw_ik()`
    - MSE global bandwidth procedure of [@ruppert1995effective]: `rdd_bw_rsw()`
    
##Estimation
RDD parametric estimation: `rdd_reg_lm()` This includes specifying the polynomial order, including covariates with various specifications as advocated in [@imbens2008regression].

RDD local non-parametric estimation: `rdd_reg_np()`. Can also include covariates, and allows different types of inference (fully non-parametric, or parametric approximation). 

RDD generalised estimation: allows to use custom estimating functions to get the RDD coefficient. Could allow for example a probit RDD, or quantile regression.
    

## Post-Estimation
    
A collection of Post-Estimation tools allow the robustness of the estimation results to be verified.

Various tools, to obtain predictions at given covariate values ( `rdd_pred()` ), or to convert to other classes, to lm ( `as.lm()` ), or to the package `np` ( `as.npreg()` ). 

Function to do inference with clustered data: `clusterInf()` either using a cluster covariance matrix ( ``vcovCluster()`` ) or by a degrees of freedom correction (as in [@cameron2008bootstrap]).

Contains functions to replicate the Monte-Carlo simulations of [Imbens and Kalyanaraman 2012]: `gen_mc_ik()`



## Regression Sensitivity Analysis

Plot the sensitivity of the coefficient with respect to the bandwith: `plotSensi()`

**Placebo plot** using different cutpoints: `plotPlacebo()`

## Design sensitivity analysis

McCrary test of manipulation of the forcing variable: wrapper `dens_test()` to the function `DCdensity()` from package `rdd`. 

Test of equal means of covariates: `covarTest_mean()`

Test of equal density of covariates: `covarTest_dens()`


# Data

A collection of typical data sets is included in the package.

- INDH, Arcand [-@arcand2015development]: `indh`
- Seminal dataset of Lee [-@lee2008randomized]: `house`

Both data sets is made available as a `data.frame`.
Using the previously discuss `rdd_data()` function we can transform a `data.frame` to an object of class `rdd_data`, which inherits from `data.frame`.

Here we can the data from the Initiative Nationale du Development Humaine (INDH), a development project in Morocco.
The data is included with the package under the name `indh`.

```{r, echo=FALSE, message=FALSE}
library(rddtools)
data("indh")
ls()
```

Now that we have loading the data we can briefly inspect the structure of the data.

```{r}
str(indh)
```

The `indh` object is a `data.frame` containing 720 observations (representing individuals) of two variables:

- `choice_pg`
- `poverty`

The variable of interest is `choice_pg`, which represent the decision to contibute to a public good or not.
The observations are individuals choosing to contribute or not, these individuals are clustered by the variable `commune` which is the municiple structure at which funding was distributed as part of the INDH project.
The forcing variable is `poverty` which represents the number of households in a commune living below the poverty threshold.
As part of the INDH, commune with a proportion of household below the poverty threshhold greater than 30% were allowed to distribute the funding using a **Community Driven Development** scheme.
The cutoff point for our analysis is therefore `30`.

We can now transform the `data.frame` to a special `rdd_data`-class object, inhereting from the `data.frame` class using the `rdd_data()` function.

```{r}
rdd_dat_indh <- rdd_data(y=choice_pg,
                         x=poverty,
                         data=indh,
                         cutpoint=30 )
```

The `rdd_data()` can be used using the `data` argument, in which case the function will look for the values o `y` and `x` in this argument (before looking in the `.GlobalEnv`), if this argument is `NULL`, only the `.GlobalEnv` will be scanned.

The structure is similar to the original `data.frame` object, but contains some additional information.

```{r}
str(rdd_dat_indh)
```

Thee `rdd_data` object has the classes `data.frame` and `rdd_data`.
It contains two variables, `y` the explanandum or dependent variable and `x` the explanans or driving variable, which is also our discontinuous variable.
Related to the discontinuous variable is the `attribute` called `cutpoint`, which describes where in the domain of `x` the discontinuity occurs.
Additional exogenous variab



# Analysis

In order to best understand our data, we start with an exploratory data analysis using tables...

```{r}
summary(rdd_dat_indh)
```

...and plots.

```{r}
plot(rdd_dat_indh[1:715,])
```

We can now continue with a standard Regression Discontinuity Design estimation.

```{r}
reg_para <- rdd_reg_lm(rdd_dat_indh, order=4)
print(reg_para) # uses print.rdd_data
```

and visualising this estimation.

```{r}
plot(reg_para)
```

In addition to the parametric estimation, we can also perform a non-parametric estimation.

```{r}
bw_ik <- rdd_bw_ik(rdd_dat_indh)
(reg_nonpara <- rdd_reg_np(rdd_object=rdd_dat_indh, bw=bw_ik))
```

and visualising the non-parametric estimation.

```{r}
plot(reg_nonpara)
```

Sensitity tests.

```{r}
plotSensi(reg_nonpara, from=0.05, to=1, by=0.1)
```


# Conclusion and Discussion

The package `rddtools` provides a unified framework for working with Regression Discontinuity Data in `R`.
Functionality already available is several existing packages, such as `rdd` and `KernSmooth` can now easilty be utlised using the `rdd_data` framework, as well as several linking functions.

In addition to this, new tools and algorithms are also implement, as well as various post-estimation robustness checks.

Future packages implementing further RDD functionality can easily leverage the `rdd_data` framework, which allows users to quickly access new functionality through a familiar API.


# References
